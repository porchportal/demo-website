<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Medical Visualization Hub</title>
    <link rel="stylesheet" href="css/styles.css">

    <!-- GitHub Pages SPA Support Script -->
    <script type="text/javascript">
        // Single Page Apps for GitHub Pages
        // MIT License
        // https://github.com/rafgraph/spa-github-pages
        var pathSegmentsToKeep = 0;
        var l = window.location;
        if (l.search) {
            var q = {};
            l.search.slice(1).split('&').forEach(function(v) {
                var a = v.split('=');
                q[a[0]] = a.slice(1).join('=').replace(/~and~/g, '&');
            });
            if (q.p !== undefined) {
                window.history.replaceState(null, null,
                    l.pathname.slice(0, -1) + (q.p || '') +
                    (q.q ? ('?' + q.q) : '') +
                    l.hash
                );
            }
        }
    </script>
</head>
<body>
    <!-- Main Menu Page -->
    <div id="main-menu" class="page-content active">
        <div class="container">
            <h1 data-label="mainMenu.title"></h1>
            <div class="button-grid">
                <button class="nav-button lvef-button" onclick="navigateToPage('lvef')" data-label="mainMenu.buttons.lvef">
                </button>
                <button class="nav-button attention-button" onclick="navigateToPage('attention')" data-label="mainMenu.buttons.attention">
                </button>
                <button class="nav-button image-button" onclick="navigateToPage('image1')">
                    <img src="assets/images/OpenMirai_logo.png" alt="OpenMirai">
                </button>
                <button class="nav-button image-button" onclick="navigateToPage('image2')">
                    <img src="assets/images/LimAyutthaya_logo.jpg" alt="Lim Ayutthaya">
                </button>
            </div>
        </div>
    </div>

    <!-- LVEF Page -->
    <div id="lvef-page" class="page-content">
        <div class="container">
            <button class="back-button" onclick="navigateToPage('main')" data-label="navigation.backButton"></button>
            <h1 data-label="lvefPage.title"></h1>
            <div id="lvef-content">
                <p data-label="lvefPage.loading"></p>
            </div>
        </div>
    </div>

    <!-- Attention Dot Page -->
    <div id="attention-page" class="page-content">
        <div class="container">
            <button class="back-button" onclick="navigateToPage('main')" data-label="navigation.backButton"></button>
            <h1 data-label="attentionPage.title"></h1>
            <div id="attention-content">
                <p data-label="attentionPage.loading"></p>
            </div>
        </div>
    </div>

    <!-- Image Pages -->
    <div id="image1-page" class="page-content">
        <div class="container">
            <button class="back-button" onclick="navigateToPage('main')" data-label="navigation.backButton"></button>
            <h1 data-label="imagePage1.title"></h1>
            <div id="image1-content">
                <p data-label="imagePage1.content"></p>
            </div>
        </div>
    </div>

    <div id="image2-page" class="page-content">
        <div class="container">
            <button class="back-button" onclick="navigateToPage('main')" data-label="navigation.backButton"></button>
            <h1 data-label="imagePage2.title"></h1>
            <div id="image2-content">
                <p data-label="imagePage2.content"></p>
            </div>
        </div>
    </div>

    <script>
        // Load labels from JSON
        let labels = {};

        async function loadLabels() {
            try {
                const response = await fetch('assets/context/main_page.json');
                labels = await response.json();
                applyLabels();
            } catch (error) {
                console.error('Error loading labels:', error);
            }
        }

        function applyLabels() {
            document.querySelectorAll('[data-label]').forEach(element => {
                const path = element.getAttribute('data-label');
                const value = getNestedValue(labels, path);
                if (value) {
                    element.textContent = value;
                }
            });
        }

        function getNestedValue(obj, path) {
            return path.split('.').reduce((current, key) => current?.[key], obj);
        }

        // Navigation configuration
        const pages = {
            'main': { id: 'main-menu', title: 'Medical Visualization Hub' },
            'lvef': {
                id: 'lvef-page',
                title: 'LVEF Visualization',
                loader: async () => {
                    // Dynamic import for TypeScript modules
                    const { initializeLVEF } = await import('./ts/lvef.js');
                    initializeLVEF();
                }
            },
            'attention': {
                id: 'attention-page',
                title: 'Attention Dot Visualization',
                loader: async () => {
                    const { initializeAttention } = await import('./ts/attention.js');
                    initializeAttention();
                }
            },
            'image1': { id: 'image1-page', title: 'Image 1' },
            'image2': { id: 'image2-page', title: 'Image 2' }
        };

        // Navigation system
        function navigateToPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.remove('active');
            });

            // Show target page
            const targetPage = document.getElementById(pages[pageId].id);
            if (targetPage) {
                targetPage.classList.add('active');

                // Update URL
                history.pushState({ page: pageId }, pages[pageId].title, `#${pageId}`);

                // Load page content if needed
                if (pages[pageId].loader) {
                    pages[pageId].loader().catch(err => {
                        console.error('Error loading page:', err);
                        // Fallback: just show the page without dynamic content
                    });
                }
            }
        }

        // Handle browser back/forward buttons
        window.addEventListener('popstate', (event) => {
            const pageId = location.hash.slice(1) || 'main';
            navigateToPage(pageId);
        });

        // Handle initial page load
        document.addEventListener('DOMContentLoaded', async () => {
            await loadLabels();
            const initialPage = location.hash.slice(1) || 'main';
            if (initialPage !== 'main') {
                navigateToPage(initialPage);
            }
        });
    </script>
</body>
</html>
